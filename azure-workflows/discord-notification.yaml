parameters:
  - name: status
    type: string
  - name: definitionName
    type: string
  - name: branch
    type: string
  - name: buildId
    type: string
  - name: projectUri
    type: string

steps:
    - task: Bash@3 # Linux - Hosted by Microsoft or self-hosted Windows with gitbash on Path
      displayName: 'Send Discord notification'
      dependsOn: unit-auto.yaml
      condition: always()
      inputs:
        targetType: 'inline'
        script: |
            export LANG=C.UTF-8
            export LC_ALL=C.UTF-8

            if [ "${{ parameters.status }}" == "Succeeded" ]; then
                STATUS="✅ Build succeeded"
            else
                STATUS="❌ Build failed"
            fi

            curl -H "Content-Type: application/json; charset=utf-8" \
                -X POST \
                -d "{\"content\": \"📦 *Pipeline:* ${{ parameters.definitionName }}\n🔀 *Branch:* ${{ parameters.branch }}\n💬 *Status:* $STATUS\n🔗 *Link:* ${{ parameters.projectUri }}_build/results?buildId=${{ parameters.buildId }}\"}" \
                "$DISCORD_WEBHOOK_URL"

      env:
        DISCORD_WEBHOOK_URL: $(DISCORD_WEBHOOK_URL)
