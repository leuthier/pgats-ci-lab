parameters:
  - name: status
    type: string
  - name: definitionName
    type: string
  - name: branch
    type: string
  - name: buildId
    type: string
  - name: projectUri
    type: string

steps:
    - task: Bash@3 # Linux - Hosted by Microsoft or self-hosted Windows with gitbash on Path
      displayName: 'Send Discord notification'
      condition: always()
      inputs:
        targetType: 'inline'
        script: |
          if [ "${{ parameters.status }}" == "Succeeded" ]; then
            STATUS="âœ… Build succeeded"
          else
            STATUS="âŒ Build failed"
          fi

          curl -H "Content-Type: application/json" \
              -X POST \
              -d "{\"content\": \"ğŸ“¦ *Pipeline:* ${{ parameters.definitionName }}\nğŸ”€ *Branch:* ${{ parameters.branch }}\nğŸ’¬ *Status:* $STATUS\nğŸ”— *Link:* ${{ parameters.projectUri }}_build/results?buildId=${{ parameters.buildId }}\"}" \
              "$DISCORD_WEBHOOK_URL"
      env:
        DISCORD_WEBHOOK_URL: $(DISCORD_WEBHOOK_URL)
